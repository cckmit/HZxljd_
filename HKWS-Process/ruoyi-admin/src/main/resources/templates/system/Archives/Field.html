<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>数智闲林·统一门户管理平台</title>
    <link th:href = "@{/layui/css/layui.css}" rel = "stylesheet" />
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/icon/iconfont.css}" rel="stylesheet"/>
    <link th:href = "@{/css/font-awesome.min.css}" rel = "stylesheet" />
    <link th:href="@{/css/public.css}" rel="stylesheet"/>
    <link th:href="@{/css/Thing.css}" rel="stylesheet"/>

    <script>
        //rem布局动态更改html
        (function (win) {
            var tid;

            function refreshRem() {
                let designSize = 1920;
                let html = document.documentElement;
                let wW = html.clientWidth;
                let rem = (wW * 100) / designSize;
                document.documentElement.style.fontSize = rem + "px";
            }

            win.addEventListener(
                "resize",
                function () {
                    clearTimeout(tid);
                    tid = setTimeout(refreshRem, 100);
                },
                false
            );
            win.addEventListener(
                "pageshow",
                function (e) {
                    if (e.persisted) {
                        clearTimeout(tid);
                        tid = setTimeout(refreshRem, 100);
                    }
                },
                false
            );

            refreshRem();
        })(window);
    </script>
</head>
<body>
<div class = "mediaCont">
<div th:include="common/header :: header"></div>
<div th:include="common/sidebar::sidebar(activeUri='field')" class = "nav_sider"></div>
</div>
    <div class = "mediaCont mediaCenter">
<div class = "container-fluid nav-stacked Thing-nav" id="exportDiv">
    <div class="thingTab layui-row">
        <ul class = "trend-Tabtile thingTitle layui-row" id = "dataTab">
            <li class = " active">近一天</li>
            <li class = "">近一周</li>
            <li class = "">近一月</li>
            <li class = "">近一年</li>
        </ul>
        <div class = "trend_operation">
            <ul class = "operationLeft operationRight">
                <li class = "operationActive" title = "图表"><i class = "iconfont">&#xe60f;</i></li>
                <li title = "报表" onClick="javaScript:location.href = '/system/archives/FieldEventList';"><i class = "iconfont">&#xe691;</i></li>
            </ul>
            <ul class = "operationRight">
                <li title = "刷新" onclick="javaScript:location.reload();"><i class = "fa fa-refresh"></i></li>
                <li title = "导出" onclick="exportPdf()"><i class = "fa fa-download"></i></li>
            </ul>
        </div>

    </div>
    <div class = "layui-row thing-title">
        <div class = "layui-col-md8">
            <div class = "layui-row" style = "height: 13vh">
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe604;</i>
                        <span>区域总数</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖区域数量">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="region-count"></b>
<!--                        <p class="Up">+45%同比增长</p>-->
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe7ca;</i>
                        <span>区域平均件数</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "预警事件总数/区域总数">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="region-event-avg-count"></b>
                        <p class="region-event-avg-count-rate"></p>
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe621;</i>
                        <span>区域人数</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖人员数量">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="region-people-count"></b>
                        <p class="region-people-count-rate"></p>
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe638;</i>
                        <span>区域负荷率</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "预警事件总数/街道工作人员数量，街道负荷值越大，则表示街道工作人员的工作任务越重">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="region-load"></b>
                        <p class="region-load-rate">+25%同比增长</p>
                    </div>
                </div>
            </div>
            <div class = "layui-row thing-trend">
                <div class = "layui-row" style = "height: 15%">
                    <div class = "layui-col-md6 trend-title">
                        <p>赋能流转 <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年预警事件处置节点情况分析图">&#xe623;</i></p>
                    </div>
<!--                    <div class = "layui-col-md6 trend-tab">-->
<!--                        <ul class = "layui-row trend-Tabtile" id="funeng">-->
<!--                            <li class = "layui-col-md4 active">-->
<!--                                本日-->
<!--                            </li>-->
<!--                            <li class = "layui-col-md4">本周</li>-->
<!--                            <li class = "layui-col-md4">本月</li>-->
<!--                        </ul>-->
<!--                        <div class = "thing-data">-->
<!--                            <input-->
<!--                                    type = "text"-->
<!--                                    class = "layui-input"-->
<!--                                    id = "day-range"-->
<!--                                    readonly-->
<!--                                    placeholder = "请选择日期范围"-->
<!--                            />-->
<!--                            <i class = "iconfont">&#xe616;</i>-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
                <div
                        class = "layui-row"
                        style = "height: 85%"
                >
                    <div
                            class = ""
                            id = "total"
                            style = "width: 100%; height: 100%"
                    ></div>
                </div>
            </div>
        </div>
        <div class = "layui-col-md4" style = "">
            <div class = "layui-row  empowerment">
                <div class = "layui-row thing-empowerment">
                    <div class = "layui-col-md6 trend-title">
                        <p>区域效率分析<i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年区域处置效率情况分析图">&#xe623;</i></p>
                    </div>
                    <div class = "layui-col-md6 trend-tab">

                    </div>
                </div>
                <div
                    class = "layui-row"
                    style = "height: 85%"
                >
                    <div
                        class = ""
                        id = "purchase"
                        style = "width: 100%; height: 100%"
                    ></div>

                </div>
            </div>
        </div>
    </div>
    <div class = "layui-row testing">
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md9 trend-title">
                    <p>区域分布分析<i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年区域事件发生数情况分析图">&#xe623;</i></p>
                </div>
                <div class = "layui-col-md3 sortCenter" onclick = "dataSort(this)">
                    事件发生频次
                    <div class = "echartsSort">
                        <i class = "iconfont sortUp">&#xe610;</i>
                        <i class = "iconfont sortDown">&#xe611;</i>
                    </div>
                </div>
            </div>
            <div
                    class = "layui-row"
                    style = "height: 87%"
            >
                <div
                        class = ""
                        id = "testing"
                        style = "width: 100%; height: 100%"
                ></div>
            </div>
        </div>
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md4 trend-title">
                    <p>区域类型分析<i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年区域所属类型情况分析图">&#xe623;</i></p>
                </div>
<!--                <div class = "layui-col-md8 trend-tab">-->
<!--                    <ul class = "trend-Tabtile layui-row" id="leixing">-->
<!--                        <li class = "layui-col-md4 active">本日</li>-->
<!--                        <li class = "layui-col-md4">本周</li>-->
<!--                        <li class = "layui-col-md4">本月</li>-->
<!--                    </ul>-->
<!--                    <form class = "layui-form">-->
<!--                        <select name = "" lay-verify = "" id="event-type-select" lay-filter="college" class="select">-->
<!--                            <option value = "" >请选择事件</option>-->
<!--                        </select>-->
<!--                    </form>-->
<!--                </div>-->
            </div>
            <div
                    class = "layui-row"
                    style = "height: 85%"
            >
                <div
                        class = ""
                        id = "Statistics"
                        style = "width: 100%; height: 100%"
                ></div>
            </div>
        </div>
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md6 trend-title">
                    <p>区域处置分析<i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年区域处置情况分析图">&#xe623;</i></p>
                </div>
                <div class = "layui-col-md6 trend-tab">
                    <ul class = "sortTab layui-row" id="fenxi">
                        <li class = "active">
                            流转率
                            <div class = "echartsSort" onclick = "dataSort(this)">
                                <i class = "iconfont sortUp">&#xe610;</i>
                                <i class = "iconfont sortDown">&#xe611;</i>
                            </div>
                        </li>
                        <li class = "" style = "">
                            共治率
                            <div class = "echartsSort" onclick = "dataSort(this)">
                                <i class = "iconfont sortUp">&#xe610;</i>
                                <i class = "iconfont sortDown">&#xe611;</i>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div
                    class = "layui-row echartsScroll"
                    style = "height: 30vh;overflow:auto;"
            >
                <div
                        class = ""
                        id = "analysis"
                        style = "width: 100%; height: 100%"
                ></div>

            </div>
        </div>
    </div>
</div>
</div>
</body>

<script th:src = "@{/layui/layui.js}"></script>
<script th:src="@{/js/echarts.min.js}"></script>
<script th:src="@{/js/export-tools/html2canvas.min.js}"></script>
<script th:src="@{/js/export-tools/jspdf.min.js}"></script>


<!--tab切换数据-->
<script>
    $('#dataTab li').on('click',function (){
        // 删除li的active
        $('#dataTab li').removeClass('active');
        // 给当前li添加active
        $(this).addClass('active');
        // 判断当前那个li被点击切换echarts数据
        if($('#dataTab li:eq(0)').is('.active')){
            regionCount("day");
            regionChange("day");
            regionEfficiency("day");
            regionLoad("day");
            regionEventType("day");
        }else if($('#dataTab li:eq(1)').is('.active')){
            regionCount("week");
            regionChange("week");
            regionEfficiency("week");
            regionLoad("week");
            regionEventType("week");
        } else if ($('#dataTab li:eq(2)').is('.active')) {
            regionCount("month");
            regionChange("month");
            regionEfficiency("month");
            regionLoad("month");
            regionEventType("month");
        }else if ($('#dataTab li:eq(3)').is('.active')) {
            regionCount("year");
            regionChange("year");
            regionEfficiency("year");
            regionLoad("year");
            regionEventType("year");
        }
    })
    // 事件分析
    $('#fenxi li').on('click',function (){
        // 删除li的active
        $('#fenxi li').removeClass('active');
        // 删除别处的排序按钮
        $('#fenxi li').find('.echartsSort').hide();
        // 给当前li添加active
        $(this).addClass('active');
        // 显示当前的排序按钮
        $(this).find('.echartsSort').css('display','flex');
        // 判断当前那个li被点击切换echarts数据
        if($('#fenxi li:eq(0)').is('.active')){
            regionEventAnalysis("0");
        }else if($('#fenxi li:eq(1)').is('.active')){
            regionEventAnalysis("1")
        }
    })
    //init 区域总数、区域平均数、区域人数、区域负荷率
    $(document).ready(function () {
        regionCount("day");
        regionChange("day");
        regionEfficiency("day");
        regionLoad("day");
        regionEventType("day");
        regionEventAnalysis("0");
        loadEventEClassifications();
    });

    //一域一档 社区总数 社区平均件数 社区人数 社区负荷
    function regionCount(dayType){
        $.ajax({
            url: "/system/archives/regionCount",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    let regionCount = data.data.regionCount;//事件总数
                    let regionEventAvgCount = data.data.regionEventAvgCount;//完成总数
                    let regionPeopleCount = data.data.regionPeopleCount;//流转率
                    let regionLoad = data.data.regionLoad;//共治率
                    $(".region-count").html(regionCount);
                    $(".region-event-avg-count").html(regionEventAvgCount);
                    $(".region-people-count").html(regionPeopleCount);
                    $(".region-load").html(regionLoad);
                    $(".region-event-avg-count-rate").html(data.data.regionEventAvgCountRate);
                    $(".region-people-count-rate").html(data.data.regionPeopleCountRate);
                    $(".region-load-rate").html(data.data.regionLoadRate);
                }
            }
        })
    }

    //
    // funeng([40,38,80,94,141,87,104,120,78,88,69,100,67,]);
    // xiaolv([262,145,86]);
    // tongji([35, 12, 13, 16, 24]);
    // fenxi([21, 33, 41, 48, 61, 69, 76, 87]);

    //赋能流转
    function regionChange(dayType){
        $.ajax({
            url: "/system/archives/regionChange",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var total = echarts.init(document.getElementById("total"));
                    var Toption = {
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                type: "line",
                            },
                            formatter:function (params) {
                                // console.log(params)
                                var str = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0070cc;"></span>'+params[0].name+'：'+params[0].value;
                                return str ;
                            }
                        },
                        legend: {
                            top: "bottom",
                            itemWidth: 15,
                            itemHeight: 15,
                            textStyle: {
                                color: '#555'
                            }
                        },
                        grid: {
                            left: "5%",
                            top: "5%",
                            right: "5%",
                            bottom: "10%",
                            containLabel: true,
                        },
                        xAxis: {
                            type: "category",
                            axisLine: {
                                lineStyle: {
                                    color: "#888",
                                },
                            },
                            axisTick: {
                                show: false,
                            },
                            axisLabel: {
                                textStyle: {
                                    color: "#333",
                                },
                                interval: 0,
                                rotate: 30,
                            },
                            data: data.data.eventChangeNames,
                        },
                        yAxis: {
                            type: "value",
                            axisLine: {
                                show: false,
                            },
                            axisTick: {
                                show: false,
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    type: "dashed",
                                },
                            },
                            axisLabel: {
                                textStyle: {
                                    color: "#333",
                                },
                            },
                            // boundaryGap: [0, 0.01],
                        },
                        color: ["#0070CC", "#B7CFFF"],
                        series: [
                            {
                                name: "预警事件发生数",
                                type: "bar",
                                data:data.data.eventChangeCounts ,
                                barGap: 0,
                                barWidth: 15,

                            },
                        ],
                    };
                    total.setOption(Toption);
                }
            }
        })
    }

    //社区效率
    function regionEfficiency(dayType){
        // 社区效率echarts
        $.ajax({
            url: "/system/archives/eventChange",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    // 赋能流转echarts
                    var purchase = echarts.init(document.getElementById("purchase"));
                    var Poption = {
                        tooltip: {
                            trigger: "item",
                            formatter: function (params) {
                                // console.log(params);
                                var str = params.marker + params.name+' '+ params.value;
                                return str;
                            },
                        },
                        grid: {
                            top: 5,
                            left: 5,
                            right: 5,
                            bottom: 5,
                        },
                        color: ["#FEC400", "#0070CC",'#F98A65', "#2ACA96",],
                        series: [
                            {
                                name: "流转率",
                                type: "funnel",
                                left: "10%",
                                top: "5%",
                                right:'15%',
                                //x2: 80,
                                bottom: "5%",
                                // width: "80%",
                                // height: {totalHeight} - y - y2,
                                // min: 10,
                                // max: 100,
                                minSize: "0%",
                                maxSize: "80%",
                                sort: "descending",
                                gap: 3,
                                label: {
                                    normal: {
                                        show: true,
                                        position: "inside",
                                        formatter: "{d}%",
                                    },
                                },
                                labelLine: {
                                    length: 10,
                                    lineStyle: {
                                        width: 1,
                                        type: "solid",
                                    },
                                },
                                itemStyle: {
                                    borderColor: "#fff",
                                    borderWidth: 0,
                                },
                                data:data.data.eventChangeRateVOS,
                            },
                            {
                                name: "流转率",
                                type: "funnel",
                                left: "10%",
                                top: "5%",
                                right:'15%',
                                //x2: 80,
                                bottom: "5%",
                                // width: "80%",
                                // min: 10,
                                // max: 100,
                                minSize: "0%",
                                maxSize: "80%",
                                sort: "descending",
                                gap: 3,
                                label: {
                                    normal: {
                                        show: true,
                                        // itemStyle:{
                                        color: "#333",
                                        formatter: function (params) {
                                            // console.log(params);
                                            var str =
                                                params.data.name +
                                                "   " +
                                                params.data.value;
                                            return str;
                                        },
                                        // }
                                    },
                                },
                                labelLine: {
                                    length: 10,
                                    lineStyle: {
                                        width: 1,
                                        type: "solid",
                                        color: "#888",
                                    },
                                },
                                itemStyle: {
                                    borderColor: "#fff",
                                    borderWidth: 0,
                                },
                                data: data.data.eventChangeVOS,
                            },
                        ],
                    };
                    purchase.setOption(Poption);
                }
            }
        })
    }

    //社区负荷
    function regionLoad(dayType){
        $.ajax({
            url: "/system/archives/regionLoad",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var testing = echarts.init(document.getElementById("testing"));
                    //社区负荷echarets
                    let toption = {
                        // tooltip: {
                        //     trigger: "axis",
                        //     axisPointer: {
                        //         // 坐标轴指示器，坐标轴触发有效
                        //         type: "line", // 默认为直线，可选为：'line' | 'shadow'
                        //     },
                        // },
                        grid: {
                            top: "5%",
                            left: "5%",
                            right: "5%",
                            bottom: "3%",
                            containLabel: true,
                        },
                        xAxis: [
                            {
                                type: "value",

                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                axisLabel: {
                                    show: false,
                                },
                                splitLine: {
                                    show: false,
                                },
                            },
                        ],
                        yAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                data: data.data.regionEfficiencyName,
                            },
                        ],
                        color:["#00BFBF"],
                        dataZoom: [
                            {
                                type: "inside",//在内部缩放
                                minSpan: 55,//用于限制窗口大小的最小值
                                show: true,//是否显示
                                realtime: true,//拖动时，是否实时更新系列的视图
                                width: "3%",
                                start: 0,//数据窗口范围的起始百分比
                                end: 55,//数据窗口范围的结束百分比
                                bottom: "0%",//组件离容器下侧的距离
                                left: "0%",//组件离容器下侧的距离
                                orient: 'vertical',//组件的布局方式
                                minValueSpan: 7,//最小显示值
                                maxValueSpan: 7,//最小显示值
                            },
                        ],
                        series: [
                            {
                                name: "负荷率",
                                type: "bar",
                                barWidth: "60%",
                                stack: 1,
                                data: data.data.regionEfficiencyCount,
                                barWidth: 10,
                                label: {
                                    show: true,
                                    position: "right",
                                },
                                itemStyle: {
                                    barBorderRadius: 15,
                                },
                            },
                        ],
                    };
                    testing.setOption(toption);
                }
            }
        })

    }

    //事件加载
    function loadEventEClassifications(){
        $.ajax({
            url: "/system/archives/eventEClassifications",
            data: {

            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    // 赋能流转echarts
                    let selectDept = $("#event-type-select");
                    data.data.forEach(function (o,i) {
                        selectDept.append("<option value = "+o.ec_name_type+">"+o.ec_name+"</option>");
                    })
                }
            }
        })
    }

    //类型统计-事件选择
    function regionEventTypeByName(value){
        $.ajax({
            url: "/system/archives/regionEventTypeByName",
            data: {
                eventType:value
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var Statistics = echarts.init(document.getElementById("Statistics"));
                    var Soption = {
                        tooltip: {
                            trigger: "item",
                            formatter: function (params) {
                                var result = '';
                                result += params.marker + params.data.name + '：' + params.data.value + '(' + params.percent + '%)';
                                return result
                            }
                        },
                        grid: {
                            top: "5%",
                            left: 5,
                            right: 5,
                            bottom: "20%",
                            containLabel: true,
                        },
                        legend: {
                            // orient: 'or',
                            top: "bottom",
                            itemWidth: 15,
                            itemHeight: 15,
                            textStyle: {
                                color: '#555'
                            }
                        },
                        color: ["#217FCD", "#44CCA0", "#F8C721", "#6E7E9B", "#F98A65"],
                        series: [
                            {
                                name: "类型统计",
                                type: "pie",
                                radius: ["0%", "65%"],
                                avoidLabelOverlap: true,
                                label: {
                                    show: true,
                                    position: "outside",
                                    formatter: "{d}% {b} ",
                                },

                                labelLine: {
                                    show: true,
                                },
                                data: data.data,
                            },
                        ],
                    };
                    Statistics.setOption(Soption);
                }
            }
        })
    }

    //类型统计
    function regionEventType(dayType) {
        $.ajax({
            url: "/system/archives/regionEventType",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var Statistics = echarts.init(document.getElementById("Statistics"));
                    var Soption = {
                        tooltip: {
                            trigger: "item",
                            formatter: function (params) {
                                var result = '';
                                result += params.marker + params.data.name + '：' + params.data.value + '(' + params.percent + '%)';
                                return result
                            }
                        },
                        grid: {
                            top: "5%",
                            left: 5,
                            right: 5,
                            bottom: "20%",
                            containLabel: true,
                        },
                        legend: {
                            // orient: 'or',
                            top: "bottom",
                            itemWidth: 15,
                            itemHeight: 15,
                            textStyle: {
                                color: '#555'
                            }
                        },
                        color: ["#217FCD", "#44CCA0", "#F8C721", "#6E7E9B", "#F98A65"],
                        series: [
                            {
                                name: "类型统计",
                                type: "pie",
                                radius: ["0%", "65%"],
                                avoidLabelOverlap: true,
                                label: {
                                    show: true,
                                    position: "outside",
                                    formatter: "{d}% {b} ",
                                },

                                labelLine: {
                                    show: true,
                                },
                                data: data.data,
                            },
                        ],
                    };
                    Statistics.setOption(Soption);
                }
            }
        })
    }

    //事件分析 流转率
    function regionEventAnalysis(flag){
        $.ajax({
            url: "/system/archives/regionEventAnalysis",
            data: {
            },
            type: "get",
            success: function (data) {
                let efficiencyName = "";
                let efficiencyCount = "";
                if(flag === "0"){
                    efficiencyName = data.data.regionEfficiencyName;
                    efficiencyCount = data.data.regionEfficiencyCount;
                }else{
                    efficiencyName = data.data.regionCommonEfficiencyName;
                    efficiencyCount = data.data.regionCommonEfficiencyCount;
                }

                if (data.code == '0') {
                    // 流转率echarts
                    var analysis = echarts.init(document.getElementById("analysis"));
                    var Aoption = {
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                // 坐标轴指示器，坐标轴触发有效
                                type: "shadow", // 默认为直线，可选为：'line' | 'shadow'
                            },
                            formatter: function (params) {
                                // console.log(params)
                                var str = params[0].marker + params[0].name+'：' + params[0].value;
                                return str
                            }
                        },
                        grid: {
                            top: "5%",
                            left: "5%",
                            right: "10%",
                            bottom: "3%",
                            containLabel: true,
                        },
                        xAxis: [
                            {
                                type: "value",

                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                axisLabel: {
                                    show: false,
                                },
                                splitLine: {
                                    show: false,
                                },
                                nameGap: 20,
                                boundaryGap: false,
                            },
                        ],
                        yAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                data: efficiencyName,
                                axisLabel: {
                                    color: '#333'
                                },
                            },
                        ],
                        toolbox:{
                            show:false,
                            feature: {
                                saveAsImage: {}
                            }

                        },
                        dataZoom: [
                            {
                                type: "inside",//在内部缩放
                                minSpan: 55,//用于限制窗口大小的最小值
                                show: true,//是否显示
                                realtime: true,//拖动时，是否实时更新系列的视图
                                width: "3%",
                                start: 0,//数据窗口范围的起始百分比
                                end: 55,//数据窗口范围的结束百分比
                                bottom: "0%",//组件离容器下侧的距离
                                left: "0%",//组件离容器下侧的距离
                                orient:'vertical',//组件的布局方式
                                minValueSpan: 7,//最小显示值
                                maxValueSpan: 7,//最小显示值
                            },
                        ],
                        color:["#2785D3"],
                        series: [
                            {
                                name: "流转率",
                                type: "bar",
                                // barWidth: "60%",
                                stack: "1",
                                data:efficiencyCount ,
                                barWidth: 10,
                                label: {
                                    show: true,
                                    formatter: "{c}%",
                                    position: "right",
                                },
                                itemStyle: {
                                    barBorderRadius: 15,
                                },
                            },
                        ],
                    };
                    analysis.setOption(Aoption);
                }
            }
        })
    }

    layui.use(["laydate", "element", "form"], function () {
        var laydate = layui.laydate;
        var element = layui.element;
        var form = layui.form;

        $('#strongBase').on('click', function () {
            layer.msg('暂未开放')
        });
        $('#zongzhi').on('click', function () {
            layer.msg('暂未开放')
        });
        $('#zhian').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#quyu').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#sheqing').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#minsheng').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#zhihui').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#pingtai').on('click', function () {
            layer.msg('暂未开放')
        })
        $("#shugan").on('click',function () {
            layer.msg('暂未开放');
        })

        //执行一个laydate实例
        laydate.render({
            elem: "#day-range", //指定元素
            range: true, //范围选择
            done:function (value, date, endDate) {
                let startDateStr = date.year+"-"+date.month+"-"+date.date;
                let endDateStr =  endDate.year+"-"+endDate.month+"-"+endDate.date;
                //事件趋势 范围选择
                $.ajax({
                    url: "/system/archives/regionChangeByDate",
                    data: {
                        "startDate":startDateStr,
                        "endDate":endDateStr
                    },
                    type: "get",
                    success: function (data) {
                        if (data.code == '0') {
                            var total = echarts.init(document.getElementById("total"));
                            var Toption = {
                                tooltip: {
                                    trigger: "axis",
                                    axisPointer: {
                                        type: "line",
                                    },
                                    formatter:function (params) {
                                        // console.log(params)
                                        var str = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0070cc;"></span>'+params[0].name+'：'+params[0].value;
                                        return str ;
                                    }
                                },
                                legend: {
                                    top: "bottom",
                                    itemWidth: 15,
                                    itemHeight: 15,
                                    textStyle: {
                                        color: '#555'
                                    }
                                },
                                grid: {
                                    left: "5%",
                                    top: "5%",
                                    right: "5%",
                                    bottom: "10%",
                                    containLabel: true,
                                },
                                xAxis: {
                                    type: "category",
                                    axisLine: {
                                        lineStyle: {
                                            color: "#888",
                                        },
                                    },
                                    axisTick: {
                                        show: false,
                                    },
                                    axisLabel: {
                                        textStyle: {
                                            color: "#333",
                                        },
                                    },
                                    data: data.data.eventChangeNames,
                                },
                                yAxis: {
                                    type: "value",
                                    axisLine: {
                                        show: false,
                                    },
                                    axisTick: {
                                        show: false,
                                    },
                                    splitLine: {
                                        show: true,
                                        lineStyle: {
                                            type: "dashed",
                                        },
                                    },
                                    axisLabel: {
                                        textStyle: {
                                            color: "#333",
                                        },
                                    },
                                    // boundaryGap: [0, 0.01],
                                },
                                color: ["#0070CC", "#B7CFFF"],
                                series: [
                                    {
                                        name: "预警事件发生数",
                                        type: "line",
                                        data:data.data.eventChangeCounts ,
                                        smooth: true,
                                        itemStyle: {
                                            borderWidth: 2,
                                            color: {
                                                type: "linear",
                                                x: 0,
                                                y: 0,
                                                x2: 0,
                                                y2: 1,
                                                colorStops: [
                                                    {
                                                        offset: 0,
                                                        color: "rgba(0,112,204,0.5)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 1,
                                                        color: "rgba(0,112,204,0.3)", // 100% 处的颜色
                                                    },
                                                ],
                                                global: false, // 缺省为 false
                                            },
                                        },
                                        symbolSize: 0,
                                        lineStyle: {
                                            width: 2,
                                            color: {
                                                type: "linear",
                                                x: 0,
                                                y: 0,
                                                x2: 1,
                                                y2: 1,
                                                colorStops: [
                                                    {
                                                        offset: 0,
                                                        color: "rgba(0,112,204)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 0.5,
                                                        color: "rgba(0,112,204)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 1,
                                                        color: "rgba(0,112,204)", // 100% 处的颜色
                                                    },
                                                ],
                                                global: true, // 缺省为 false
                                            },
                                        },
                                        areaStyle: [],
                                    },
                                ],
                            };
                            total.setOption(Toption);
                        }
                    }
                })
            }
        });

        //类型统计 事件类型选中
        form.on("select(college)", function(data){
            if(!("" == data.value)){
                regionEventTypeByName(data.value);
            }
        });
    });


    setTimeout(() => {
        var testing = echarts.init(document.getElementById("testing"));
        var analysis = echarts.init(document.getElementById("analysis"));
        var Statistics = echarts.init(document.getElementById("Statistics"));
        var total = echarts.init(document.getElementById("total"));
        var purchase = echarts.init(document.getElementById("purchase"));
        window.onresize = function () {
            purchase.resize();
            testing.resize();
            Statistics.resize();
            total.resize();
            analysis.resize();
        };
    }, 500);
    // 设置提示框组件
    $('[data-toggle="tooltip"]').tooltip()

    // 点击排序
    var sortId=0;
    function dataSort(sort) {
        $(sort).addClass('active');
        if(sortId == 0){
            $(sort).find('.sortDown').hide();
            $(sort).find('.sortUp').show();
            sortId =1;
        }else{
            $(sort).find('.sortUp').hide();
            $(sort).find('.sortDown').show();
            sortId = 0;
        }
        // event.stopPropagation();
        // setTimeout(()=>{
        //     $(sort).removeClass('active');
        // },5000)
    }

    //导出pdf报告
    function exportPdf() {
        window.scrollTo(0, 0); // 避免内容缺失
        html2canvas($('#exportDiv'), {
            onrendered: function (canvas) {
                let contentWidth = canvas.width;
                let contentHeight = canvas.height;

                //一页pdf显示html页面生成的canvas高度;
                let pageHeight = (contentWidth / 595.28) * 841.89;
                //未生成pdf的html页面高度
                let leftHeight = contentHeight;
                //pdf页面偏移
                let position = 0;
                //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
                let imgWidth = 555.28;
                let imgHeight = (555.28 / contentWidth) * contentHeight;

                let pageData = canvas.toDataURL("image/jpeg", 1.0);

                let pdf = new jsPDF("", "pt", "a4");
                //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
                //当内容未超过pdf一页显示的范围，无需分页
                if (leftHeight < pageHeight) {
                    pdf.addImage(pageData, "JPEG", 20, 0, imgWidth, imgHeight);
                } else {
                    while (leftHeight > 0) {
                        pdf.addImage(
                            pageData,
                            "JPEG",
                            20,
                            position,
                            imgWidth,
                            imgHeight
                        );
                        leftHeight -= pageHeight;
                        position -= 841.89;
                        //避免添加空白页
                        if (leftHeight > 0) {
                            pdf.addPage();
                        }
                    }
                }
                pdf.save("一域一档图表报告.pdf");
            },
        });
    }


</script>

</html>
