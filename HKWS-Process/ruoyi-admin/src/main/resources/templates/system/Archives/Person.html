<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>数智闲林·统一门户管理平台</title>
    <link th:href = "@{/layui/css/layui.css}" rel = "stylesheet" />
    <link th:href = "@{/css/bootstrap.min.css}" rel = "stylesheet" />
    <link th:href = "@{/icon/iconfont.css}" rel = "stylesheet" />
    <link th:href = "@{/css/font-awesome.min.css}" rel = "stylesheet" />
    <link th:href = "@{/css/public.css}" rel = "stylesheet" />
    <link th:href = "@{/css/Thing.css}" rel = "stylesheet" />

    <script>
        //rem布局动态更改html
        (function (win) {
            var tid;

            function refreshRem() {
                let designSize = 1920;
                let html = document.documentElement;
                let wW = html.clientWidth;
                let rem = (wW * 100) / designSize;
                document.documentElement.style.fontSize = rem + "px";
            }

            win.addEventListener(
                "resize",
                function () {
                    clearTimeout(tid);
                    tid = setTimeout(refreshRem, 100);
                },
                false
            );
            win.addEventListener(
                "pageshow",
                function (e) {
                    if (e.persisted) {
                        clearTimeout(tid);
                        tid = setTimeout(refreshRem, 100);
                    }
                },
                false
            );

            refreshRem();
        })(window);
    </script>
</head>
<body>
<div class = "mediaCont">
<div th:include="common/header :: header"></div>
<div th:include="common/sidebar::sidebar(activeUri='person')" class = "nav_sider"></div>
</div>
<div class = "mediaCont mediaCenter">
<div class = "container-fluid nav-stacked Thing-nav" id="exportDiv">
    <div class = "thingTab layui-row">
        <ul class = "trend-Tabtile thingTitle layui-row" id = "dataTab">
            <li class = " active">近一天</li>
            <li class = "">近一周</li>
            <li class = "">近一月</li>
            <li class = "">近一年</li>
        </ul>
        <div class = "trend_operation">
            <ul class = "operationLeft operationRight">
                <li class = "operationActive" title = "图表"><i class = "iconfont">&#xe60f;</i></li>
                <li title = "报表" onClick = "javaScript:location.href = '/system/archives/PersonEventList';"><i class = "iconfont">&#xe691;</i></li>
            </ul>
            <ul class = "operationRight">
                <li title = "刷新" onclick="javaScript:location.reload();"><i class = "fa fa-refresh"></i></li>
                <li title = "导出" onclick="exportPdf()"><i class = "fa fa-download"></i></li>
            </ul>
        </div>
    </div>
    <div class = "layui-row thing-title">
        <div class = "layui-col-md8">
            <div class = "layui-row" style = "height: 13vh">
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class="iconfont">&#xe603;</i>
                        <span>人员数</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖社区人员总人数">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="region-people-count"></b>
                        <p class="region-people-count-rate"></p>
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe631;</i>
                        <span>在线率</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖社区人员在线率">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="account-status-count"></b>
                        <p class = "account-status-count-rate"></p>
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe6f8;</i>
                        <span>人均件数</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖社区人员人均处理事件个数">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="event-avg-count"></b>
                        <p class = "event-avg-count-rate"></p>
                    </div>
                </div>
                <div class = "layui-col-md3 thing-total">
                    <p>
                        <i class = "iconfont">&#xe641;</i>
                        <span>人均时长</span>
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "青山湖街道下辖社区人员人均处理时长">&#xe623;</i>
                    </p>
                    <div class = "thing-num">
                        <b class="avg-event-time"></b>
                        <p class = "avg-event-time-rate"></p>
                    </div>
                </div>
            </div>
            <div class = "layui-row thing-trend">
                <div class = "layui-row" style = "height: 15%">
                    <div class = "layui-col-md6 trend-title">
                        <p>处置效率
                            <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年社区人员处置效率情况分析图">&#xe623;</i>
                        </p>
                    </div>
<!--                    <div class = "layui-col-md6 trend-tab">-->
<!--                        <ul class = "layui-row trend-Tabtile" id="xiaolv">-->
<!--                            <li class = "layui-col-md4 active">-->
<!--                                本日-->
<!--                            </li>-->
<!--                            <li class = "layui-col-md4">本周</li>-->
<!--                            <li class = "layui-col-md4">本月</li>-->
<!--                        </ul>-->
<!--                        <div class = "thing-data">-->
<!--                            <input-->
<!--                                    type = "text"-->
<!--                                    class = "layui-input"-->
<!--                                    id = "people-day-range"-->
<!--                                    readonly-->
<!--                                    placeholder = "请选择日期范围"-->
<!--                            />-->
<!--                            <i class = "iconfont">&#xe616;</i>-->
<!--                            &lt;!&ndash;                <i class = "Thiconfont">&#xe6ff;</i>&ndash;&gt;-->
<!--                        </div>-->
<!--                    </div>-->
                </div>
                <div
                        class = "layui-row"
                        style = "height: 85%"
                >
                    <div
                            class = ""
                            id = "total"
                            style = "width: 100%; height: 100%"
                    ></div>
                </div>
            </div>
        </div>
        <div class = "layui-col-md4" style = "">
            <div class = "layui-row  empowerment">
                <div class = "layui-row thing-empowerment">
                    <div class = "layui-col-md6 trend-title">
                        <p>队伍统计
                            <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年社区人员情况分析图">&#xe623;</i>
                        </p>
                    </div>
                    <!--                <div class = "layui-col-md6 trend-tab">-->
                    <!--                    <ul class = "trend-Tabtile layui-row" id="tongji">-->
                    <!--                        <li class = "layui-col-md4 active">本日</li>-->
                    <!--                        <li class = "layui-col-md4">本周</li>-->
                    <!--                        <li class = "layui-col-md4">本月</li>-->
                    <!--                    </ul>-->
                    <!--                </div>-->
                </div>
                <div
                    class = "layui-row"
                    style = "height: 85%"
                >
                    <div
                        class = ""
                        style = "
                                width: 100%;
                                height: 100%;
                                position: relative;
                            "
                    >
                        <div
                            id = "purchase"
                            style = "width: 100%; height: 100%"
                        ></div>
                        <!-- 在线离线情况 -->
                        <!--<div class = "state_sg">
                        <span>
                            <i class = "state-zai"></i>
                            <b>15</b>
                        </span>
                            <span>
                            <i class = "state-li"> </i>
                            <b>8</b>
                        </span>
                        </div>-->
                        <!--<div class = "state_wg">
                            <span><i class = "state-zai"></i><b>40</b></span>
                            <span><i class = "state-li"></i><b>14</b></span>
                        </div>
                        <div class = "state_gz">
                            <span><i class = "state-zai"></i><b>87</b></span>
                            <span><i class = "state-li"></i><b>19</b></span>
                        </div>

                        <div class = "zai">
                            <span><i class = "state_zai"></i>在线</span>
                            <span><i class = "state_li"></i>离线</span>
                        </div>-->
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class = "layui-row testing">
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md6 trend-title">
                    <p>处置分析
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年社区人员处置个数情况分析图">&#xe623;</i>
                    </p>
                </div>
<!--                <div class = "layui-col-md6 trend-tab">-->
<!--                    <ul class = "trend-Tabtile layui-row" id="fenxi">-->
<!--                        <li class = "layui-col-md4 active">本日</li>-->
<!--                        <li class = "layui-col-md4">本周</li>-->
<!--                        <li class = "layui-col-md4">本月</li>-->
<!--                    </ul>-->
<!--                </div>-->
            </div>
            <div
                    class = "layui-row"
                    style = "height: 87%"
            >
                <div
                        class = ""
                        id = "testing"
                        style = "width: 100%; height: 100%"
                ></div>
            </div>
        </div>
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md4 trend-title">
                    <p>效率管理
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年社区人员处置效率情况分析图">&#xe623;</i>
                    </p>
                </div>
<!--                <div class = "layui-col-md8 trend-tab">-->
<!--                    <ul class = "trend-Tabtile layui-row" id="guanli">-->
<!--                        <li class = "layui-col-md4 active">本日</li>-->
<!--                        <li class = "layui-col-md4">本周</li>-->
<!--                        <li class = "layui-col-md4">本月</li>-->
<!--                    </ul>-->
<!--                    <form class = "layui-form">-->
<!--                        <select name = "" id="dept-name-select" lay-filter="college" class="select">-->
<!--                            <option value = "" >请选择社区</option>-->
<!--                        </select>-->
<!--                    </form>-->
<!--                </div>-->
            </div>
            <div
                    class = "layui-row"
                    style = "height: 85%"
            >
                <div
                        class = ""
                        id = "Statistics"
                        style = "width: 100%; height: 100%"
                ></div>
            </div>
        </div>
        <div class = "layui-col-md4 testing-ting">
            <div class = "layui-row thing-empowerment">
                <div class = "layui-col-md6 trend-title">
                    <p>耗时检测
                        <i class = "iconfont explain" data-toggle = "tooltip" data-trigger = "hover" data-placement = "bottom" title = "近一天、近一周、近一月、近一年社区人员处置耗时情况分析图">&#xe623;</i>
                    </p>
                </div>
                <div class = "layui-col-md6 trend-tab">
                    <ul class = "trend-Tabtile layui-row" id="jiance">
                        <li class = "layui-col-md4 active">网格员</li>
                        <li class = "layui-col-md4">城管</li>
                        <li class = "layui-col-md4">共治力量</li>
                    </ul>
                </div>
            </div>
            <div
                    class = "layui-row"
                    style = "height: 85%"
            >
                <div
                        class = ""
                        id = "analysis"
                        style = "width: 100%; height: 100%"
                ></div>
            </div>
        </div>
    </div>
</div>
</div>
</body>

<script th:src = "@{/layui/layui.js}"></script>
<script th:src = "@{/js/echarts.min.js}"></script>
<script th:src="@{/js/export-tools/html2canvas.min.js}"></script>
<script th:src="@{/js/export-tools/jspdf.min.js}"></script>

<!--tab切换数据-->
<script>
    // 处置效率
    $('#dataTab li').on('click', function () {
        // 删除li的active
        $('#dataTab li').removeClass('active');
        // 给当前li添加active
        $(this).addClass('active');
        // 判断当前那个li被点击切换echarts数据
        // 显示在/离线人数
        if ($('#dataTab li:eq(0)').is('.active')) {
            peopleInfo("day");
            peopleDisposalEfficiency("day");
            peopleType("day");
            peopleDisposalAnalysis("day");
            peopleEfficiency("day");
           /* $('.state_sg').find('.state-zai').next().text('15');
            $('.state_sg').find('.state-li').next().text('8');
            $('.state_wg').find('.state-zai').next().text('40');
            $('.state_wg').find('.state-li').next().text('14');
            $('.state_gz').find('.state-zai').next().text('97');
            $('.state_gz').find('.state-li').next().text('19');*/

        } else if ($('#dataTab li:eq(1)').is('.active')) {
            peopleInfo("week");
            peopleDisposalEfficiency("week");
            peopleType("week");
            peopleDisposalAnalysis("week");
            peopleEfficiency("week");
            /*$('.state_sg').find('.state-zai').next().text('20');
            $('.state_sg').find('.state-li').next().text('10');
            $('.state_wg').find('.state-zai').next().text('45');
            $('.state_wg').find('.state-li').next().text('11');
            $('.state_gz').find('.state-zai').next().text('100');
            $('.state_gz').find('.state-li').next().text('12');*/
        } else if ($('#dataTab li:eq(2)').is('.active')) {
            peopleInfo("month");
            peopleDisposalEfficiency("month");
            peopleType("month");
            peopleDisposalAnalysis("month");
            peopleEfficiency("month");
            /*$('.state_sg').find('.state-zai').next().text('35');
            $('.state_sg').find('.state-li').next().text('15');
            $('.state_wg').find('.state-zai').next().text('50');
            $('.state_wg').find('.state-li').next().text('15');
            $('.state_gz').find('.state-zai').next().text('102');
            $('.state_gz').find('.state-li').next().text('10');*/
        } else if ($('#dataTab li:eq(3)').is('.active')) {
            peopleInfo("year");
            peopleDisposalEfficiency("year");
            peopleType("year");
            peopleDisposalAnalysis("year");
            peopleEfficiency("year");
            /*$('.state_sg').find('.state-zai').next().text('35');
            $('.state_sg').find('.state-li').next().text('15');
            $('.state_wg').find('.state-zai').next().text('50');
            $('.state_wg').find('.state-li').next().text('15');
            $('.state_gz').find('.state-zai').next().text('102');
            $('.state_gz').find('.state-li').next().text('10');*/
        }
    })
    // 耗时检测
    $('#jiance li').on('click', function () {
        // 删除li的active
        $('#jiance li').removeClass('active');
        // 给当前li添加active
        $(this).addClass('active');
        // 判断当前那个li被点击切换echarts数据
        if ($('#jiance li:eq(0)').is('.active')) {
            peopleTime("111");
        } else if ($('#jiance li:eq(1)').is('.active')) {
            peopleTime("222");
        }else if ($('#jiance li:eq(2)').is('.active')) {
            peopleTime("333");
        }
    })


    //init 一人一档 人员数 在线率 人均件数 人均时长
    $(document).ready(function () {
        peopleInfo("day");
        peopleDisposalEfficiency("day");
        peopleType("day");
        peopleDisposalAnalysis("day");
        deptNameOption();
        peopleEfficiency("day");
        peopleTime("111");
        // peopleEfficiencyByDeptName()
    });

    function peopleInfo(dayType){
        $.ajax({
            url: "/system/archives/peopleInfo",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    let regionPeopleCount = data.data.regionPeopleCount;//人员数
                    let accountStatusCount = data.data.accountStatusCount;//在线率
                    let eventAvgCount = data.data.eventAvgCount;//人均件数
                    let avgEventTime = data.data.avgEventTime;//人均时长
                    $(".region-people-count").html(regionPeopleCount);
                    $(".account-status-count").html(accountStatusCount);
                    $(".event-avg-count").html(eventAvgCount);
                    $(".avg-event-time").html(avgEventTime);
                    $(".region-people-count-rate").html(data.data.regionPeopleCountRate);
                    $(".account-status-count-rate").html(data.data.accountStatusCountRate);
                    $(".event-avg-count-rate").html(data.data.eventAvgCountRate);
                    $(".avg-event-time-rate").html(data.data.avgEventTimeRate);
                }
            }
        })
    }

    //处置效率
    function peopleDisposalEfficiency(dayType){
        $.ajax({
            url: "/system/archives/peopleDisposalEfficiency",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    // console.log(data.data);
                    var totalX = data.data.eventTrendDate;
                    var totalY1 = data.data.eventTrend;//
                    var totalY2 = data.data.eventPlaceTypeTrends;//街面违规事件
                    if (totalY2.length == 0) {
                        totalX.forEach(item => {
                            totalY2.push(0)
                        })
                    }
                    if (totalY1.length == 0) {
                        totalX.forEach(item => {
                            totalY1.push(0)
                        })
                    }
                    var total = echarts.init(document.getElementById("total"));
                    var Toption = {
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                type: "line",
                            },
                            formatter: function (params) {
                                // console.log(params)
                                var str = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0070cc;"></span>' + params[0].name+'：' + params[0].value;
                                return str;
                            }
                        },
                        legend: {
                            top: "bottom",
                            itemWidth: 15,
                            itemHeight: 15,
                            icon: "circle",
                            textStyle: {
                                color: '#555'
                            }
                        },
                        grid: {
                            left: "5%",
                            top: "5%",
                            right: "5%",
                            bottom: "10%",
                            containLabel: true,
                        },
                        xAxis: {
                            type: "category",
                            axisLine: {
                                lineStyle: {
                                    color: "#888",
                                },
                            },
                            axisTick: {
                                show: false,
                            },
                            axisLabel: {
                                interval: 0,
                                rotate: 30,
                                textStyle: {
                                    color: "#333",
                                },
                            },
                            data: totalX,
                        },
                        yAxis: {
                            type: "value",
                            axisLine: {
                                show: false,
                            },
                            axisTick: {
                                show: false,
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    type: "dashed",
                                },
                            },
                            axisLabel: {
                                textStyle: {
                                    color: "#333",
                                },
                            },
                            // boundaryGap: [0, 0.01],
                        },
                        color: ["#6395F9", "#B7CFFF"],
                        series: [
                            {
                                name: "街面违规事件",
                                type: "line",
                                data: totalY2,
                                smooth: true,
                                itemStyle: {
                                    borderWidth: 2,
                                    color: {
                                        type: "linear",
                                        x: 0,
                                        y: 0,
                                        x2: 0,
                                        y2: 1,
                                        colorStops: [
                                            {
                                                offset: 0,
                                                color: "rgba(0,112,204)", // 0% 处的颜色
                                            },
                                            {
                                                offset: 1,
                                                color: "rgba(0,112,204,0.2)", // 100% 处的颜色
                                            },
                                        ],
                                        global: false, // 缺省为 false
                                    },
                                },
                                symbolSize: 8,
                                lineStyle: {
                                    width: 2,
                                    color: {
                                        type: "linear",
                                        x: 0,
                                        y: 0,
                                        x2: 1,
                                        y2: 1,
                                        colorStops: [
                                            {
                                                offset: 0,
                                                color: "rgba(0,112,204)", // 0% 处的颜色
                                            },
                                            {
                                                offset: 0.5,
                                                color: "rgba(0,112,204)", // 0% 处的颜色
                                            },
                                            {
                                                offset: 1,
                                                color: "rgba(0,112,204)", // 100% 处的颜色
                                            },
                                        ],
                                        global: true, // 缺省为 false
                                    },
                                },
                                areaStyle: [],
                            },
                        ],
                    };
                    total.setOption(Toption);
                }
            }
        })
    };

    //队伍统计
    function peopleType(dayType){
        $.ajax({
            url: "/system/archives/peopleType",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    // console.log(data.data)
                    var purchase = echarts.init(document.getElementById("purchase"));
                    var Poption = {
                        tooltip: {
                            trigger: "item",
                            formatter: function (params) {
                                // console.log(params);
                                var str = params.marker + params.name + '：' + params.value;
                                return str;
                            },
                        },
                        grid: {
                            top: 5,
                            left: 5,
                            right: 5,
                            bottom: 5,
                        },
                        color: ["#FEC400", "#0070CC", '#F98A65', "#2ACA96",],
                        series: [
                            {
                                name: "队伍统计",
                                type: "funnel",
                                left: "10%",
                                top: "5%",
                                right:'15%',
                                //x2: 80,
                                bottom: "5%",
                                // width: "80%",
                                // height: {totalHeight} - y - y2,
                                // min: 10,
                                // max: 100,
                                minSize: "0%",
                                maxSize: "80%",
                                sort: "ascending",
                                gap: 0,
                                label: {
                                    normal: {
                                        show: true,
                                        position: "inside",
                                        formatter: "{c}人",
                                    },
                                },
                                labelLine: {
                                    length: 30,
                                    lineStyle: {
                                        width: 1,
                                        type: "solid",
                                    },
                                },
                                itemStyle: {
                                    borderColor: "#fff",
                                    borderWidth: 0,
                                },
                                data: data.data,
                            },
                            {
                                name: "赋能流转",
                                type: "funnel",
                                left: "10%",
                                top: "5%",
                                right: '15%',
                                //x2: 80,
                                bottom: "5%",
                                // width: "80%",
                                // min: 10,
                                // max: 100,
                                minSize: "0%",
                                maxSize: "80%",
                                sort: "ascending",
                                gap: 0,
                                label: {
                                    normal: {
                                        show: true,
                                        // itemStyle:{
                                        color: "#333",

                                        // }
                                    },
                                },
                                labelLine: {
                                    length: 20,
                                    lineStyle: {
                                        width: 1,
                                        type: "solid",
                                        color: "#888",
                                    },
                                },
                                itemStyle: {
                                    borderColor: "#fff",
                                    borderWidth: 0,
                                },
                                data: data.data,
                            },
                        ],
                    };
                    purchase.setOption(Poption);
                }
            }
        })
    }

    //处置分析
    function peopleDisposalAnalysis(dayType){

        $.ajax({
            url: "/system/archives/peopleDisposalAnalysis",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var testing = echarts.init(document.getElementById("testing"));
                    var toption = {
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                // 坐标轴指示器，坐标轴触发有效
                                type: "shadow", // 默认为直线，可选为：'line' | 'shadow'
                            },
                            formatter: function (params) {
                                // console.log(params);
                                var str = params[0].marker + params[0].name + '：' + params[0].value;
                                return str;
                            },
                        },
                        grid: {
                            top: "5%",
                            left: "3%",
                            right: "4%",
                            bottom: "5%",
                            containLabel: true,
                        },
                        xAxis: {
                            type: "value",
                            axisLine: {
                                show: false,
                                lineStyle: {
                                    color: "#888",
                                },
                            },
                            axisTick: {
                                show: false,
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    type: "dashed",
                                },
                            },
                            axisLabel: {
                                color: '#333'
                            }
                        },
                        yAxis: {
                            type: "category",
                            data: data.data.userNames,
                            axisLine: {
                                show: false,
                            },
                            axisTick: {
                                show: false,
                            },
                            axisLabel: {
                                color: '#333'
                            }
                        },
                        color: ["#0070cc"],
                        series: [
                            {
                                name: "处置率",
                                type: "bar",
                                data: data.data.eventCounts,
                                barWidth: 10,
                            },
                        ],
                    };
                    testing.setOption(toption);
                }
            }
        })
    }

    //效率管理-社区列表
    function deptNameOption(){
        $.ajax({
            url: "/system/archives/regionNames",
            data: {
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    let selectDept = $("#dept-name-select");
                    data.data.forEach(function (o,i) {
                        selectDept.append("<option value = "+o.deptUuid+">"+o.deptName+"</option>");
                    })
                }
            }
        })
    }

    function peopleEfficiencyByDeptName(deptName){
        $.ajax({
            url: "/system/archives/peopleEfficiencyByDeptName",
            data: {
                "deptName":deptName
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var Statistics = echarts.init(document.getElementById("Statistics"));
                    let dashedPic =
                        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM8AAAAOBAMAAAB6G1V9AAAAD1BMVEX////Kysrk5OTj4+TJycoJ0iFPAAAAG0lEQVQ4y2MYBaNgGAMTQQVFOiABhlEwCugOAMqzCykGOeENAAAAAElFTkSuQmCC";
                    let color = ["#217FCD", "#44CCA0", "#F8C721", "#6E7E9B", "#F98A65"];
                    let chartData =data.data;
                    // console.log(chartData)
                    let arrName = [];
                    let arrValue = [];
                    let sum = 0;
                    let pieSeries = [],
                        lineYAxis = [];
                    // 数据处理
                    chartData.forEach((v, i) => {
                        console.log(v,i)
                        arrName.push(v.name);
                        arrValue.push(v.value);
                        sum = sum + v.value;
                    });

                    // 图表option整理
                    chartData.forEach((v, i) => {
                        console.log(v, i)
                        pieSeries.push({
                            name: "",
                            type: "pie",
                            clockWise: false,
                            hoverAnimation: false,
                            radius: [85 - i * 15 + "%", 77 - i * 15 + "%"],
                            center: ["50%", "50%"],
                            label: {
                                show: false,
                            },
                            data: [
                                {
                                    value: v.value,
                                    name: v.name,
                                },
                                {
                                    value: sum - v.value,
                                    name: "",
                                    itemStyle: {
                                        color: "rgba(0,0,0,0)",
                                    },
                                },
                            ],
                        });
                        pieSeries.push({
                            name: "",
                            type: "pie",
                            silent: true,
                            z: 1,
                            clockWise: false, //顺时加载
                            hoverAnimation: false, //鼠标移入变大
                            radius: [85 - i * 15 + "%", 77 - i * 15 + "%"],
                            center: ["50%", "50%"],
                            label: {
                                show: false,
                            },
                            data: [
                                {
                                    value: 75,
                                    itemStyle: {
                                        color: "#E3F0FF",
                                    },
                                },
                                {
                                    value: 25,
                                    name: "",
                                    itemStyle: {
                                        color: "rgba(0,0,0,0)",
                                    },
                                },
                            ],
                        });
                        if(sum == 0){
                            v.percent = 0 + "%";
                        }else {
                            v.percent = ((v.value / sum) * 100).toFixed(1) + "%";
                        }
                        lineYAxis.push({
                            value: i,
                            textStyle: {
                                rich: {
                                    circle: {
                                        color: color[i],
                                        padding: [0, 10],
                                    },
                                },
                            },
                        });
                    });
                    var Soption = {
                        tooltip: {
                            trigger: 'item',
                            formatter:function (params) {
                                // console.log(params);
                                var str = params.marker+params.name+'：'+params.percent+'%';
                                return str;
                            }
                        },
                        backgroundColor: "#fff",
                        color: color,
                        grid: {
                            top: "5%",
                            bottom: "64%",
                            left: "50%",
                            containLabel: false,
                        },
                        yAxis: [
                            {
                                type: "category",
                                inverse: true,
                                axisLine: {
                                    show: false,
                                },
                                axisTick: {
                                    show: false,
                                },

                                axisLabel: {
                                    formatter: function (params) {
                                        let item = chartData[params];
                                        // console.log(item);
                                        return (
                                            "{line|}{circle|●}{name|" +
                                            item.name +
                                            "}{bd|}{percent|" +
                                            item.percent +
                                            "}"
                                        );
                                    },
                                    interval: 0,
                                    inside: true,
                                    textStyle: {
                                        color: "#333",
                                        fontSize: 14,
                                        rich: {
                                            line: {
                                                width: "50%",
                                                height: 10,
                                                backgroundColor: {
                                                    image: dashedPic,
                                                },
                                            },
                                            name: {
                                                color: "#666",
                                                fontSize: 14,
                                            },
                                            bd: {
                                                padding: [0, 5],
                                            },
                                            percent: {
                                                color: "#333",
                                                fontSize: 14,
                                            },
                                        },
                                    },
                                    show: true,
                                },
                                data: lineYAxis,
                            },
                        ],
                        xAxis: [
                            {
                                show: false,
                            },
                        ],
                        series: pieSeries,
                    };
                    Statistics.setOption(Soption);
                }
            }
        })
    }

    //效率管理
    function peopleEfficiency(dayType) {
        $.ajax({
            url: "/system/archives/peopleEfficiency",
            data: {
                "type":dayType
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var Statistics = echarts.init(document.getElementById("Statistics"));
                    let dashedPic =
                        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAM8AAAAOBAMAAAB6G1V9AAAAD1BMVEX////Kysrk5OTj4+TJycoJ0iFPAAAAG0lEQVQ4y2MYBaNgGAMTQQVFOiABhlEwCugOAMqzCykGOeENAAAAAElFTkSuQmCC";
                    let color = ["#217FCD", "#44CCA0", "#F8C721", "#6E7E9B", "#F98A65"];
                    let chartData =data.data;
                    // console.log(chartData)
                    let arrName = [];
                    let arrValue = [];
                    let sum = 0;
                    let pieSeries = [],
                        lineYAxis = [];

                    // 数据处理
                    chartData.forEach((v, i) => {
                        // console.log(v,i)
                        arrName.push(v.name);
                        arrValue.push(v.value);
                        sum = sum + v.value;
                    });

                    // 图表option整理
                    chartData.forEach((v, i) => {
                        pieSeries.push({
                            name: "",
                            type: "pie",
                            clockWise: false,
                            hoverAnimation: false,
                            radius: [85 - i * 15 + "%", 77 - i * 15 + "%"],
                            center: ["50%", "50%"],
                            label: {
                                show: false,
                            },
                            data: [
                                {
                                    value: v.value,
                                    name: v.name,
                                },
                                {
                                    value: sum - v.value,
                                    name: "",
                                    itemStyle: {
                                        color: "rgba(0,0,0,0)",
                                    },
                                },
                            ],
                        });
                        pieSeries.push({
                            name: "",
                            type: "pie",
                            silent: true,
                            z: 1,
                            clockWise: false, //顺时加载
                            hoverAnimation: false, //鼠标移入变大
                            radius: [85 - i * 15 + "%", 77 - i * 15 + "%"],
                            center: ["50%", "50%"],
                            label: {
                                show: false,
                            },
                            data: [
                                {
                                    value: 75,
                                    itemStyle: {
                                        color: "#E3F0FF",
                                    },
                                },
                                {
                                    value: 25,
                                    name: "",
                                    itemStyle: {
                                        color: "rgba(0,0,0,0)",
                                    },
                                },
                            ],
                        });
                        if(sum == 0){
                            v.percent = 0 + "%";
                        }else {
                            v.percent = ((v.value / sum) * 100).toFixed(1) + "%";
                        }
                        lineYAxis.push({
                            value: i,
                            textStyle: {
                                rich: {
                                    circle: {
                                        color: color[i],
                                        padding: [0, 10],
                                    },
                                },
                            },
                        });
                    });
                    var Soption = {
                        tooltip: {
                            trigger: 'item',
                            formatter:function (params) {
                                // console.log(params);
                                var str = params.marker+params.name+'：'+params.percent+'%';
                                return str;
                            }
                        },
                        backgroundColor: "#fff",
                        color: color,
                        grid: {
                            top: "5%",
                            bottom: "64%",
                            left: "50%",
                            containLabel: false,
                        },
                        yAxis: [
                            {
                                type: "category",
                                inverse: true,
                                axisLine: {
                                    show: false,
                                },
                                axisTick: {
                                    show: false,
                                },

                                axisLabel: {
                                    formatter: function (params) {
                                        let item = chartData[params];
                                        // console.log(params);
                                        return (
                                            "{line|}{circle|●}{name|" +
                                            item.name +
                                            "}{bd|}{percent|" +
                                            item.percent +
                                            "}"
                                        );
                                    },
                                    interval: 0,
                                    inside: true,
                                    textStyle: {
                                        color: "#333",
                                        fontSize: 14,
                                        rich: {
                                            line: {
                                                width: 40,
                                                height: 10,
                                                backgroundColor: {
                                                    image: dashedPic,
                                                },
                                            },
                                            name: {
                                                color: "#666",
                                                fontSize: 14,
                                            },
                                            bd: {
                                                padding: [0, 5],
                                            },
                                            percent: {
                                                color: "#333",
                                                fontSize: 14,
                                            },
                                        },
                                    },
                                    show: true,
                                },
                                data: lineYAxis,
                            },
                        ],
                        xAxis: [
                            {
                                show: false,
                            },
                        ],
                        series: pieSeries,
                    };
                    Statistics.setOption(Soption);
                }
            }
        })
    }

    //耗时检测
    function peopleTime(station){
        $.ajax({
            url: "/system/archives/peopleTime",
            data: {
                "station":station
            },
            type: "get",
            success: function (data) {
                if (data.code == '0') {
                    var analysis = echarts.init(document.getElementById("analysis"));
                    var Aoption = {
                        tooltip: {
                            trigger: "axis",
                            axisPointer: {
                                // 坐标轴指示器，坐标轴触发有效
                                type: "shadow", // 默认为直线，可选为：'line' | 'shadow'
                            },
                            formatter: function (params) {
                                // console.log(params)
                                var str = params[0].marker + params[0].name+'：' + params[0].value;
                                return str
                            }
                        },
                        grid: {
                            top: "5%",
                            left: "5%",
                            right: "4%",
                            bottom: "3%",
                            containLabel: true,
                        },
                        xAxis: [
                            {
                                type: "value",

                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                axisLabel: {
                                    show: false,
                                },
                                splitLine: {
                                    show: false,
                                },
                            },
                        ],
                        yAxis: [
                            {
                                type: "category",
                                axisTick: {
                                    show: false,
                                },
                                axisLine: {
                                    show: false,
                                },
                                data: data.data.names,
                                axisLabel: {
                                    color: '#333'
                                }
                            },
                        ],

                        series: [
                            {
                                name: "耗时检测",
                                type: "bar",
                                barWidth: "60%",
                                data: data.data.times,
                                barWidth: 10,
                                itemStyle: {
                                    barBorderRadius: 15,
                                    color: "#0070CC",
                                },
                                backgroundStyle: {
                                    color: "rgba(239,239,239, 1)",
                                    barBorderRadius: 15,
                                },
                                showBackground: true,
                                label: {
                                    show: true,
                                    position: "right",
                                    fontSize: 10,
                                },
                            },
                        ],
                    };
                    analysis.setOption(Aoption);
                }
            }
        })
    }

    layui.use(["laydate", "element", "form"], function () {
        var laydate = layui.laydate;
        var element = layui.element;
        var form = layui.form;
        $('#strongBase').on('click', function () {
            layer.msg('暂未开放')
        });
        $('#zongzhi').on('click', function () {
            layer.msg('暂未开放')
        });
        $('#zhian').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#quyu').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#sheqing').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#minsheng').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#zhihui').on('click', function () {
            layer.msg('暂未开放')
        })
        $('#pingtai').on('click', function () {
            layer.msg('暂未开放')
        })
        $("#shugan").on('click',function () {
            layer.msg('暂未开放');
        })

        //执行一个laydate实例
        laydate.render({
            elem: "#people-day-range", //指定元素
            range: true, //范围选择
            done:function (value, date, endDate) {
                let startDateStr = date.year+"-"+date.month+"-"+date.date;
                let endDateStr =  endDate.year+"-"+endDate.month+"-"+endDate.date;
                //事件趋势 范围选择
                $.ajax({
                    url: "/system/archives/eventTrendByDate",
                    data: {
                        "startDate":startDateStr,
                        "endDate":endDateStr
                    },
                    type: "get",
                    success: function (data) {
                        if (data.code == '0') {
                            var total = echarts.init(document.getElementById("total"));
                            var Toption = {
                                tooltip: {
                                    trigger: "axis",
                                    axisPointer: {
                                        type: "line",
                                    },
                                    formatter: function (params) {
                                        // console.log(params)
                                        var str = '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#0070cc;"></span>' + params[0].name+'：' + params[0].value;
                                        return str;
                                    }
                                },
                                legend: {
                                    top: "bottom",
                                    itemWidth: 15,
                                    itemHeight: 15,
                                    icon: "circle",
                                    textStyle: {
                                        color: '#555'
                                    }
                                },
                                grid: {
                                    left: "5%",
                                    top: "5%",
                                    right: "5%",
                                    bottom: "10%",
                                    containLabel: true,
                                },
                                xAxis: {
                                    type: "category",
                                    axisLine: {
                                        lineStyle: {
                                            color: "#888",
                                        },
                                    },
                                    axisTick: {
                                        show: false,
                                    },
                                    axisLabel: {
                                        formatter: function (params) {
                                            var newParamsName = "";
                                            var paramsNameNumber = params.length;
                                            var provideNumber = 6; //一行显示几个字
                                            var rowNumber = Math.ceil(
                                                paramsNameNumber / provideNumber
                                            );
                                            if (paramsNameNumber > provideNumber) {
                                                for (var p = 0; p < rowNumber; p++) {
                                                    var tempStr = "";
                                                    var start = p * provideNumber;
                                                    var end = start + provideNumber;
                                                    if (p == rowNumber - 1) {
                                                        tempStr = params.substring(
                                                            start,
                                                            paramsNameNumber
                                                        );
                                                    } else {
                                                        tempStr =
                                                            params.substring(start, end) + "\n";
                                                    }
                                                    newParamsName += tempStr;
                                                }
                                            } else {
                                                newParamsName = params;
                                            }
                                            return newParamsName;
                                        },
                                        textStyle: {
                                            color: "#333",
                                        },
                                    },
                                    data: data.data.eventTrendDate,
                                },
                                yAxis: {
                                    type: "value",
                                    axisLine: {
                                        show: false,
                                    },
                                    axisTick: {
                                        show: false,
                                    },
                                    splitLine: {
                                        show: true,
                                        lineStyle: {
                                            type: "dashed",
                                        },
                                    },
                                    axisLabel: {
                                        textStyle: {
                                            color: "#333",
                                        },
                                    },
                                    // boundaryGap: [0, 0.01],
                                },
                                color: ["#6395F9", "#B7CFFF"],
                                series: [
                                    {
                                        name: "街面违规事件",
                                        type: "line",
                                        data: data.data.eventPlaceTypeTrends,
                                        smooth: true,
                                        itemStyle: {
                                            borderWidth: 2,
                                            color: {
                                                type: "linear",
                                                x: 0,
                                                y: 0,
                                                x2: 0,
                                                y2: 1,
                                                colorStops: [
                                                    {
                                                        offset: 0,
                                                        color: "rgba(0,112,204)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 1,
                                                        color: "rgba(0,112,204,0.2)", // 100% 处的颜色
                                                    },
                                                ],
                                                global: false, // 缺省为 false
                                            },
                                        },
                                        symbolSize: 8,
                                        lineStyle: {
                                            width: 2,
                                            color: {
                                                type: "linear",
                                                x: 0,
                                                y: 0,
                                                x2: 1,
                                                y2: 1,
                                                colorStops: [
                                                    {
                                                        offset: 0,
                                                        color: "rgba(0,112,204)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 0.5,
                                                        color: "rgba(0,112,204)", // 0% 处的颜色
                                                    },
                                                    {
                                                        offset: 1,
                                                        color: "rgba(0,112,204)", // 100% 处的颜色
                                                    },
                                                ],
                                                global: true, // 缺省为 false
                                            },
                                        },
                                        areaStyle: [],
                                    },
                                ],
                            };
                            total.setOption(Toption);
                        }
                    }
                })
            }
        });


        //效率管理 社区选中
        form.on("select(college)", function(data){
            if(!("" == data.value)){
                peopleEfficiencyByDeptName(data.value);
            }
        });
    });

    setTimeout(() => {
        var total = echarts.init(document.getElementById("total"));
        var purchase = echarts.init(document.getElementById("purchase"));
        var testing = echarts.init(document.getElementById("testing"));
        var Statistics = echarts.init(document.getElementById("Statistics"));
        var analysis = echarts.init(document.getElementById("analysis"));
        window.onresize = function () {
            purchase.resize();
            testing.resize();
            Statistics.resize();
            total.resize();
            analysis.resize();
        };
    }, 500);
    // 设置提示框组件
    $('[data-toggle="tooltip"]').tooltip()

    //导出pdf报告
    function exportPdf() {
        window.scrollTo(0, 0); // 避免内容缺失
        html2canvas($('#exportDiv'), {
            onrendered: function (canvas) {
                let contentWidth = canvas.width;
                let contentHeight = canvas.height;

                //一页pdf显示html页面生成的canvas高度;
                let pageHeight = (contentWidth / 595.28) * 841.89;
                //未生成pdf的html页面高度
                let leftHeight = contentHeight;
                //pdf页面偏移
                let position = 0;
                //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
                let imgWidth = 555.28;
                let imgHeight = (555.28 / contentWidth) * contentHeight;

                let pageData = canvas.toDataURL("image/jpeg", 1.0);

                let pdf = new jsPDF("", "pt", "a4");
                //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
                //当内容未超过pdf一页显示的范围，无需分页
                if (leftHeight < pageHeight) {
                    pdf.addImage(pageData, "JPEG", 20, 0, imgWidth, imgHeight);
                } else {
                    while (leftHeight > 0) {
                        pdf.addImage(
                            pageData,
                            "JPEG",
                            20,
                            position,
                            imgWidth,
                            imgHeight
                        );
                        leftHeight -= pageHeight;
                        position -= 841.89;
                        //避免添加空白页
                        if (leftHeight > 0) {
                            pdf.addPage();
                        }
                    }
                }
                pdf.save("一人一档图表报告.pdf");
            },
        });
    }

</script>

</html>
